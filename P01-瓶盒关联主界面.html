<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1366">
<title>ç“¶ç›’å…³è”é‡‡é›†ç³»ç»Ÿ - 1å·æœº</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', 'Segoe UI', sans-serif;
    background: #E9EEF5;
    width: 1366px;
    height: 768px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    font-size: 14px;
    color: #1F2937;
  }

  /* èœå•æ  */
  .menu-bar {
    height: 32px;
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 24px;
    flex-shrink: 0;
    position: relative;
    z-index: 100;
  }
  .menu-item {
    font-size: 14px;
    color: #333;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    user-select: none;
    position: relative;
  }
  .menu-item:hover { background: #f0f4ff; }
  .menu-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: #fff;
    border: 1px solid #d0d0d0;
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    min-width: 140px;
    z-index: 1000;
  }
  .menu-item:hover .menu-dropdown { display: block; }
  .menu-dropdown-item {
    padding: 8px 16px;
    font-size: 14px;
    color: #333;
    cursor: pointer;
    white-space: nowrap;
  }
  .menu-dropdown-item:hover { background: #f0f4ff; color: #2563EB; }

  /* ä¸»å†…å®¹åŒº */
  .main-content {
    display: flex;
    flex: 1;
    gap: 16px;
    padding: 16px;
    overflow: hidden;
  }

  /* å·¦ä¾§æ  */
  .left-panel {
    width: 420px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* å¡ç‰‡ */
  .card {
    background: #FFFFFF;
    border-radius: 12px;
    border: 1px solid #D9E1EC;
    padding: 14px 16px;
  }
  .card-title {
    font-size: 15px;
    font-weight: 600;
    color: #1F2937;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid #E5E7EB;
  }

  /* å†…éƒ¨å¡ç‰‡ */
  .inner-card {
    background: #F8FBFF;
    border-radius: 10px;
    border: 1px solid #D7E7FF;
    padding: 12px 14px;
  }

  /* åŒ…è£…æ¯”ä¾‹è®¾ç½® */
  .ratio-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .ratio-label {
    font-size: 14px;
    color: #374151;
  }
  .ratio-input {
    width: 90px;
    height: 44px;
    border: 1px solid #D7E7FF;
    border-radius: 6px;
    background: #fff;
    text-align: center;
    font-size: 26px;
    font-weight: 700;
    color: #1F2937;
    font-family: inherit;
    outline: none;
  }
  .ratio-input:focus { border-color: #2563EB; box-shadow: 0 0 0 2px rgba(37,99,235,0.1); }

  /* æ“ä½œæŒ‰é’® */
  .op-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .btn {
    height: 44px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 16px;
    font-weight: 700;
    font-family: inherit;
    transition: all 0.15s;
  }
  .btn:active { transform: scale(0.97); }
  .btn-primary {
    background: #2563EB;
    color: #fff;
    width: 140px;
  }
  .btn-primary:hover { background: #1d4ed8; }
  .btn-primary.running {
    background: #DC2626;
  }
  .btn-primary.running:hover { background: #b91c1c; }
  .btn-secondary {
    background: #6B7280;
    color: #fff;
    width: 100px;
  }
  .btn-secondary:hover { background: #4B5563; }
  .btn-warning {
    background: #F59E0B;
    color: #fff;
  }
  .btn-warning:hover { background: #D97706; }
  .btn-danger {
    background: #DC2626;
    color: #fff;
  }
  .btn-danger:hover { background: #b91c1c; }

  /* è®¡æ•°åŒºåŸŸ */
  .count-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .count-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 0;
  }
  .count-label {
    font-size: 16px;
    font-weight: 600;
    color: #374151;
  }
  .count-value {
    font-size: 44px;
    font-weight: 700;
    line-height: 1;
  }
  .count-value.red { color: #DC2626; }
  .count-value.blue { color: #2563EB; }

  /* è®¾å¤‡çŠ¶æ€ */
  .device-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .device-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .device-name { font-size: 14px; color: #374151; }
  .device-status {
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .device-status.connected { color: #16A34A; }
  .device-status.disconnected { color: #DC2626; font-weight: 700; }
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }
  .dot-green { background: #16A34A; }
  .dot-red { background: #DC2626; }

  /* å³ä¾§æ  */
  .right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-width: 600px;
  }

  /* è¯»ç åŒº */
  .read-area {
    background: #FFFFFF;
    border-radius: 12px;
    border: 1px solid #D9E1EC;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .read-area-header {
    padding: 10px 16px;
    background: #F8FBFF;
    border-bottom: 1px solid #D7E7FF;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    flex-shrink: 0;
  }
  .read-area-content {
    flex: 1;
    overflow-y: auto;
    padding: 12px 16px;
  }
  .box-area { flex: 0 0 auto; min-height: 120px; max-height: 220px; }
  .bottle-area { flex: 1; }

  .log-entry {
    padding: 6px 10px;
    border-radius: 6px;
    margin-bottom: 6px;
    font-size: 14px;
    line-height: 1.5;
  }
  .log-success {
    background: #F0FDF4;
    border-left: 3px solid #16A34A;
    color: #15803D;
    font-size: 16px;
    font-weight: 700;
  }
  .log-error {
    background: #FEF2F2;
    border-left: 3px solid #DC2626;
    color: #DC2626;
    font-size: 16px;
    font-weight: 700;
  }
  .log-normal {
    background: #F9FAFB;
    border-left: 3px solid #9CA3AF;
    color: #374151;
  }
  .log-time {
    color: #9CA3AF;
    font-size: 12px;
    margin-right: 8px;
  }

  /* çŠ¶æ€æ  */
  .status-bar {
    height: 32px;
    background: #F5F7FA;
    border-top: 1px solid #D0D0D0;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 16px;
    flex-shrink: 0;
    font-size: 14px;
    color: #374151;
  }

  /* å¼¹çª— */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 500;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.active { display: flex; }
  .modal {
    background: #fff;
    border-radius: 16px;
    border: 2px solid #2563EB;
    width: 780px;
    max-height: 680px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25);
  }
  .modal-header {
    background: #2563EB;
    color: #fff;
    padding: 0 24px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }
  .modal-title { font-size: 18px; font-weight: 700; }
  .modal-close {
    width: 28px; height: 28px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
  }
  .modal-close:hover { background: rgba(255,255,255,0.35); }
  .modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 0;
  }
  .modal-footer {
    padding: 16px 24px;
    border-top: 1px solid #E5E7EB;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 12px;
    flex-shrink: 0;
  }

  /* ç³»ç»Ÿè®¾ç½®å¼¹çª—Tabs */
  .sys-tabs {
    display: flex;
    border-bottom: 1px solid #E5E7EB;
    background: #F9FAFB;
    padding: 0 16px;
  }
  .sys-tab {
    padding: 12px 20px;
    font-size: 14px;
    color: #6B7280;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    margin-bottom: -1px;
  }
  .sys-tab.active { color: #2563EB; border-color: #2563EB; font-weight: 600; }
  .sys-tab-content { display: none; padding: 20px 24px; }
  .sys-tab-content.active { display: block; }

  /* è¡¨å• */
  .form-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 14px;
  }
  .form-label {
    width: 120px;
    font-size: 14px;
    color: #374151;
    font-weight: 600;
    flex-shrink: 0;
  }
  .form-input {
    flex: 1;
    height: 40px;
    border: 1px solid #D1D5DB;
    border-radius: 6px;
    padding: 0 12px;
    font-size: 14px;
    font-family: inherit;
    outline: none;
    color: #1F2937;
  }
  .form-input:focus { border-color: #2563EB; box-shadow: 0 0 0 2px rgba(37,99,235,0.1); }
  .form-select {
    flex: 1;
    height: 40px;
    border: 1px solid #D1D5DB;
    border-radius: 6px;
    padding: 0 12px;
    font-size: 14px;
    font-family: inherit;
    outline: none;
    background: #fff;
    color: #1F2937;
  }

  /* è®¾å¤‡è¡¨æ ¼ */
  .device-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  .device-table th {
    background: #F3F4F6;
    padding: 8px 12px;
    text-align: left;
    font-weight: 600;
    color: #374151;
    border: 1px solid #E5E7EB;
  }
  .device-table td {
    padding: 8px 12px;
    border: 1px solid #E5E7EB;
    color: #374151;
  }
  .device-table tr:nth-child(even) td { background: #F9FAFB; }
  .device-table .btn-sm {
    height: 28px;
    padding: 0 10px;
    font-size: 12px;
    font-weight: 600;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-family: inherit;
  }
  .btn-sm-blue { background: #EFF6FF; color: #2563EB; }
  .btn-sm-red { background: #FEF2F2; color: #DC2626; }
  .btn-sm-green { background: #F0FDF4; color: #16A34A; }
  .btn-sm-blue:hover { background: #DBEAFE; }
  .btn-sm-red:hover { background: #FEE2E2; }

  /* å¯†ç å¼¹çª— */
  .pwd-modal {
    background: #fff;
    border-radius: 12px;
    width: 380px;
    padding: 32px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25);
    border: 1px solid #D9E1EC;
  }
  .pwd-title { font-size: 18px; font-weight: 700; color: #1F2937; margin-bottom: 20px; text-align: center; }
  .pwd-input {
    width: 100%;
    height: 48px;
    border: 1px solid #D1D5DB;
    border-radius: 8px;
    padding: 0 16px;
    font-size: 18px;
    font-family: inherit;
    outline: none;
    text-align: center;
    letter-spacing: 4px;
    margin-bottom: 8px;
  }
  .pwd-input:focus { border-color: #2563EB; box-shadow: 0 0 0 2px rgba(37,99,235,0.1); }
  .pwd-error { color: #DC2626; font-size: 13px; text-align: center; min-height: 20px; margin-bottom: 16px; }
  .pwd-btn-row { display: flex; gap: 12px; }
  .pwd-btn {
    flex: 1; height: 44px; border-radius: 6px; border: none;
    font-size: 16px; font-weight: 700; cursor: pointer; font-family: inherit;
  }
  .pwd-btn-cancel { background: #6B7280; color: #fff; }
  .pwd-btn-ok { background: #2563EB; color: #fff; }
  .pwd-btn-ok:hover { background: #1d4ed8; }
  .pwd-btn-cancel:hover { background: #4B5563; }

  /* çŠ¶æ€æ ‡ç­¾ */
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }
  .badge-green { background: #D1FAE5; color: #065F46; }
  .badge-red { background: #FEE2E2; color: #991B1B; }
  .badge-blue { background: #DBEAFE; color: #1E40AF; }

  /* æ»šåŠ¨æ¡æ ·å¼ */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: #F1F5F9; }
  ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #94A3B8; }

  /* è¿è¡ŒçŠ¶æ€æç¤º */
  .running-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #16A34A;
    font-weight: 600;
  }
  .running-dot {
    width: 8px; height: 8px;
    background: #16A34A;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.3); }
  }

  .section-divider {
    height: 1px;
    background: #E5E7EB;
    margin: 10px 0;
  }

  .toggle-switch {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #374151;
  }
  .toggle-track {
    width: 40px; height: 22px;
    background: #E5E7EB;
    border-radius: 11px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
  }
  .toggle-track.on { background: #2563EB; }
  .toggle-thumb {
    width: 18px; height: 18px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    top: 2px; left: 2px;
    transition: transform 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  .toggle-track.on .toggle-thumb { transform: translateX(18px); }

  .alarm-bar {
    display: none;
    background: #FEF2F2;
    border: 1px solid #FCA5A5;
    border-radius: 8px;
    padding: 10px 16px;
    color: #DC2626;
    font-size: 14px;
    font-weight: 600;
    align-items: center;
    gap: 10px;
    animation: alarmBlink 1s step-start infinite;
  }
  .alarm-bar.show { display: flex; }
  @keyframes alarmBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }
</style>
</head>
<body>

<!-- èœå•æ  -->
<div class="menu-bar">
  <div class="menu-item">
    æ–‡ä»¶(F)
    <div class="menu-dropdown">
      <div class="menu-dropdown-item" onclick="confirmExit()">é€€å‡ºè½¯ä»¶</div>
    </div>
  </div>
  <div class="menu-item">
    é…ç½®
    <div class="menu-dropdown">
      <div class="menu-dropdown-item" onclick="openSysSettings()">ç³»ç»Ÿè®¾ç½®</div>
    </div>
  </div>
  <div class="menu-item">
    æ•°æ®
    <div class="menu-dropdown">
      <div class="menu-dropdown-item" onclick="alert('æ“ä½œæ—¥å¿—åŠŸèƒ½')">æ“ä½œæ—¥å¿—</div>
    </div>
  </div>
  <div class="menu-item">
    å¸®åŠ©(H)
    <div class="menu-dropdown">
      <div class="menu-dropdown-item" onclick="alert('æ“ä½œå¸®åŠ©æ–‡æ¡£')">æ“ä½œå¸®åŠ©</div>
      <div class="menu-dropdown-item" onclick="alert('ç“¶ç›’å…³è”é‡‡é›†ç³»ç»Ÿ v1.2\nçŸ³æ¹¾äº§çº¿ 1å·æœº')">å…³äºç³»ç»Ÿ</div>
    </div>
  </div>
  <div style="margin-left:auto; display:flex; align-items:center; gap:12px;">
    <span id="runningIndicator" class="running-indicator" style="display:none;">
      <span class="running-dot"></span>é‡‡é›†ä¸­
    </span>
    <span style="font-size:13px; color:#6B7280;">ç“¶ç›’å…³è”é‡‡é›†ç³»ç»Ÿ - 1å·æœº</span>
  </div>
</div>

<!-- ä¸»å†…å®¹åŒº -->
<div class="main-content">

  <!-- å·¦ä¾§æ  -->
  <div class="left-panel">

    <!-- åŒ…è£…æ¯”ä¾‹è®¾ç½® + æ“ä½œ å¡ç‰‡åˆå¹¶ -->
    <div class="card" style="padding:14px 16px;">
      <!-- åŒ…è£…æ¯”ä¾‹ -->
      <div class="inner-card" style="margin-bottom:10px;">
        <div style="font-size:13px; font-weight:600; color:#374151; margin-bottom:8px;">åŒ…è£…æ¯”ä¾‹è®¾ç½®</div>
        <div class="ratio-row">
          <span class="ratio-label">æ¯ç›’ç“¶æ•°</span>
          <input type="number" class="ratio-input" id="bottlesPerBox" value="6" min="1" max="24">
        </div>
      </div>
      <!-- æ“ä½œ -->
      <div class="inner-card" style="padding:10px 14px;">
        <div class="op-row">
          <button class="btn btn-primary" id="startBtn" onclick="toggleCapture()">å¼€å§‹é‡‡é›†</button>
          <button class="btn btn-secondary" onclick="clearScreen()">æ¸…å±</button>
        </div>
      </div>
      <!-- æŠ¥è­¦æç¤º -->
      <div id="alarmBar" class="alarm-bar" style="margin-top:10px;">
        <span>âš </span>
        <span id="alarmMsg">å…³è”å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç è¯»å–æƒ…å†µ</span>
        <button onclick="closeAlarm()" style="margin-left:auto; background:#DC2626; color:#fff; border:none; border-radius:4px; padding:2px 10px; cursor:pointer; font-size:12px;">å…³é—­æŠ¥è­¦</button>
      </div>
    </div>

    <!-- è®¡æ•° -->
    <div class="card">
      <div class="card-title">è®¡æ•°</div>
      <div class="inner-card">
        <div class="count-grid">
          <div class="count-item">
            <span class="count-label">åˆè®¡ç“¶æ•°</span>
            <span class="count-value red" id="totalBottles">0</span>
          </div>
          <div class="section-divider"></div>
          <div class="count-item">
            <span class="count-label">å½“å‰ç›’æ•°</span>
            <span class="count-value blue" id="totalBoxes">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- è®¾å¤‡è¿æ¥çŠ¶æ€ -->
    <div class="card">
      <div class="card-title">è®¾å¤‡è¿æ¥çŠ¶æ€</div>
      <div class="inner-card">
        <div class="device-list">
          <div class="device-item">
            <span class="device-name">ç“¶1è¯»ç å™¨</span>
            <span class="device-status connected" id="dev1Status">
              <span class="status-dot dot-green"></span>å·²è¿æ¥
            </span>
          </div>
          <div class="device-item">
            <span class="device-name">ç“¶2è¯»ç å™¨</span>
            <span class="device-status connected" id="dev2Status">
              <span class="status-dot dot-green"></span>å·²è¿æ¥
            </span>
          </div>
          <div class="device-item">
            <span class="device-name">ç›’è¯»ç å™¨</span>
            <span class="device-status connected" id="dev3Status">
              <span class="status-dot dot-green"></span>å·²è¿æ¥
            </span>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /left-panel -->

  <!-- å³ä¾§æ  -->
  <div class="right-panel">

    <!-- ç›’ç è¯»ç åŒºï¼ˆçº¦30%ï¼‰-->
    <div class="read-area box-area" style="flex: 0 0 200px;">
      <div class="read-area-header">
        ç›’ç è¯»ç åŒº <span style="font-size:12px; color:#9CA3AF; font-weight:400;">ï¼ˆæœ€æ–°åœ¨ä¸Šï¼Œæœ€å¤š1000æ¡ï¼‰</span>
      </div>
      <div class="read-area-content" id="boxLogArea">
        <div class="log-entry log-success">
          <span class="log-time">10:30:16</span>
          ç›’è¯»ç ï¼š20241201001002 &nbsp;|&nbsp; <strong>1ç›’ç å…³è”æˆåŠŸ</strong>
        </div>
        <div class="log-entry log-normal">
          <span class="log-time">10:30:08</span>
          ç›’è¯»ç ï¼š20241201001001 &nbsp;|&nbsp; 1ç›’ç å…³è”æˆåŠŸ
        </div>
        <div class="log-entry log-normal">
          <span class="log-time">10:29:55</span>
          ç›’è¯»ç ï¼š20241201001000 &nbsp;|&nbsp; 1ç›’ç å…³è”æˆåŠŸ
        </div>
      </div>
    </div>

    <!-- ç“¶ç è¯»ç åŒºï¼ˆçº¦70%ï¼‰-->
    <div class="read-area bottle-area" style="flex: 1;">
      <div class="read-area-header">
        ç“¶ç è¯»ç åŒº <span style="font-size:12px; color:#9CA3AF; font-weight:400;">ï¼ˆæœ€æ–°åœ¨ä¸Šï¼Œæœ€å¤š1000æ¡ï¼‰</span>
      </div>
      <div class="read-area-content" id="bottleLogArea">
        <div class="log-entry log-success">
          <span class="log-time">10:30:14</span>
          ç“¶1è¯»ç ï¼š<span style="color:#2563EB;">20241201010001</span>ã€<span style="color:#2563EB;">20241201010002</span>ã€<span style="color:#2563EB;">20241201010003</span>ã€<span style="color:#2563EB;">20241201010004</span>
          &nbsp;&nbsp;
          ç“¶2è¯»ç ï¼š<span style="color:#2563EB;">20241201010005</span>ã€<span style="color:#2563EB;">20241201010006</span>
        </div>
        <div class="log-entry log-normal">
          <span class="log-time">10:30:06</span>
          ç“¶1è¯»ç ï¼š20241201009995ã€20241201009996ã€20241201009997ã€20241201009998 &nbsp;&nbsp; ç“¶2è¯»ç ï¼š20241201009999ã€20241201010000
        </div>
        <div class="log-entry log-error">
          <span class="log-time">10:29:52</span>
          ç“¶1è¯»ç ï¼š20241201009989 &nbsp;&nbsp; ç“¶2è¯»ç ï¼š<span style="background:#FEE2E2; padding:1px 4px; border-radius:3px;">20241201009990ï¼ˆé‡ç ï¼‰</span>ã€20241201009991 &nbsp;|&nbsp; âš  æ£€æµ‹åˆ°é‡ç ï¼Œå·²æ ‡è®°å‰”é™¤
        </div>
        <div class="log-entry log-normal">
          <span class="log-time">10:29:44</span>
          ç“¶1è¯»ç ï¼š20241201009983ã€20241201009984ã€20241201009985 &nbsp;&nbsp; ç“¶2è¯»ç ï¼š20241201009986ã€20241201009987ã€20241201009988
        </div>
        <div class="log-entry log-normal">
          <span class="log-time">10:29:36</span>
          ç“¶1è¯»ç ï¼š20241201009977ã€20241201009978ã€20241201009979 &nbsp;&nbsp; ç“¶2è¯»ç ï¼š20241201009980ã€20241201009981ã€20241201009982
        </div>
        <div class="log-entry log-normal">
          <span class="log-time">10:29:28</span>
          ç“¶1è¯»ç ï¼š20241201009971ã€20241201009972ã€20241201009973 &nbsp;&nbsp; ç“¶2è¯»ç ï¼š20241201009974ã€20241201009975ã€20241201009976
        </div>
      </div>
    </div>

  </div><!-- /right-panel -->

</div><!-- /main-content -->

<!-- çŠ¶æ€æ  -->
<div class="status-bar">
  <span id="currentTime">2024-12-01 10:30:00</span>
</div>

<!-- å¯†ç éªŒè¯å¼¹çª— -->
<div class="modal-overlay" id="pwdOverlay" onclick="closePwdIfOutside(event)">
  <div class="pwd-modal" onclick="event.stopPropagation()">
    <div class="pwd-title">ğŸ”’ è¯·è¾“å…¥ç³»ç»Ÿå¯†ç </div>
    <input type="password" class="pwd-input" id="pwdInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="12"
           onkeydown="if(event.key==='Enter')verifyPwd()">
    <div class="pwd-error" id="pwdError"></div>
    <div class="pwd-btn-row">
      <button class="pwd-btn pwd-btn-cancel" onclick="closePwd()">å–æ¶ˆ</button>
      <button class="pwd-btn pwd-btn-ok" onclick="verifyPwd()">ç¡®è®¤</button>
    </div>
  </div>
</div>

<!-- ç³»ç»Ÿè®¾ç½®å¼¹çª— -->
<div class="modal-overlay" id="sysOverlay" onclick="closeSysIfOutside(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <span class="modal-title">ç³»ç»Ÿè®¾ç½®ï¼ˆ1å·æœºï¼‰</span>
      <button class="modal-close" onclick="closeSys()">âœ•</button>
    </div>
    <div class="sys-tabs">
      <div class="sys-tab active" onclick="switchSysTab(this,'tab-io')">IOè®¾å¤‡ç®¡ç†</div>
      <div class="sys-tab" onclick="switchSysTab(this,'tab-printer')">æ‰“å°æœºç®¡ç†</div>
      <div class="sys-tab" onclick="switchSysTab(this,'tab-alarm')">æŠ¥è­¦è®¾ç½®</div>
      <div class="sys-tab" onclick="switchSysTab(this,'tab-db')">æ•°æ®åº“è¿æ¥</div>
    </div>
    <div class="modal-body">
      <!-- IOè®¾å¤‡ç®¡ç† -->
      <div class="sys-tab-content active" id="tab-io">
        <div style="margin-bottom:12px; display:flex; gap:8px;">
          <button class="btn btn-primary" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="alert('æ·»åŠ è®¾å¤‡')">+ æ·»åŠ è®¾å¤‡</button>
        </div>
        <table class="device-table">
          <thead>
            <tr>
              <th>è®¾å¤‡åç§°</th>
              <th>è®¾å¤‡ç±»å‹</th>
              <th>è¿æ¥åœ°å€</th>
              <th>ç«¯å£</th>
              <th>çŠ¶æ€</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ç“¶1ç›¸æœº</td>
              <td>ç½‘ç»œç›¸æœº</td>
              <td>192.168.1.101</td>
              <td>3000</td>
              <td><span class="badge badge-green">å·²è¿æ¥</span></td>
              <td style="display:flex;gap:6px;flex-wrap:wrap;">
                <button class="btn-sm btn-sm-blue" onclick="alert('ç¼–è¾‘è®¾å¤‡')">ç¼–è¾‘</button>
                <button class="btn-sm btn-sm-green" onclick="alert('è¿æ¥æµ‹è¯•æˆåŠŸ')">æµ‹è¯•</button>
                <button class="btn-sm btn-sm-red" onclick="alert('ç¡®è®¤åˆ é™¤ï¼Ÿ')">åˆ é™¤</button>
              </td>
            </tr>
            <tr>
              <td>ç“¶2ç›¸æœº</td>
              <td>ç½‘ç»œç›¸æœº</td>
              <td>192.168.1.102</td>
              <td>3000</td>
              <td><span class="badge badge-green">å·²è¿æ¥</span></td>
              <td style="display:flex;gap:6px;flex-wrap:wrap;">
                <button class="btn-sm btn-sm-blue" onclick="alert('ç¼–è¾‘è®¾å¤‡')">ç¼–è¾‘</button>
                <button class="btn-sm btn-sm-green" onclick="alert('è¿æ¥æµ‹è¯•æˆåŠŸ')">æµ‹è¯•</button>
                <button class="btn-sm btn-sm-red" onclick="alert('ç¡®è®¤åˆ é™¤ï¼Ÿ')">åˆ é™¤</button>
              </td>
            </tr>
            <tr>
              <td>ç›’ç ç›¸æœº</td>
              <td>ç½‘ç»œç›¸æœº</td>
              <td>192.168.1.103</td>
              <td>3000</td>
              <td><span class="badge badge-green">å·²è¿æ¥</span></td>
              <td style="display:flex;gap:6px;flex-wrap:wrap;">
                <button class="btn-sm btn-sm-blue" onclick="alert('ç¼–è¾‘è®¾å¤‡')">ç¼–è¾‘</button>
                <button class="btn-sm btn-sm-green" onclick="alert('è¿æ¥æµ‹è¯•æˆåŠŸ')">æµ‹è¯•</button>
                <button class="btn-sm btn-sm-red" onclick="alert('ç¡®è®¤åˆ é™¤ï¼Ÿ')">åˆ é™¤</button>
              </td>
            </tr>
            <tr>
              <td>æŠ¥è­¦ç¯</td>
              <td>ä¸²å£RS485</td>
              <td>COM3</td>
              <td>9600</td>
              <td><span class="badge badge-green">å·²è¿æ¥</span></td>
              <td style="display:flex;gap:6px;flex-wrap:wrap;">
                <button class="btn-sm btn-sm-blue" onclick="alert('ç¼–è¾‘è®¾å¤‡')">ç¼–è¾‘</button>
                <button class="btn-sm btn-sm-green" onclick="alert('è¿æ¥æµ‹è¯•æˆåŠŸ')">æµ‹è¯•</button>
                <button class="btn-sm btn-sm-red" onclick="alert('ç¡®è®¤åˆ é™¤ï¼Ÿ')">åˆ é™¤</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- æ‰“å°æœºç®¡ç† -->
      <div class="sys-tab-content" id="tab-printer">
        <div class="form-row">
          <span class="form-label">æ‰“å°æœºåç§°</span>
          <input type="text" class="form-input" value="Canon LBP2900" placeholder="æ‰“å°æœºåç§°">
        </div>
        <div class="form-row">
          <span class="form-label">æ‰“å°æœºIP</span>
          <input type="text" class="form-input" value="192.168.1.200">
        </div>
        <div class="form-row">
          <span class="form-label">æ‰“å°ç«¯å£</span>
          <input type="text" class="form-input" value="9100">
        </div>
        <div class="form-row">
          <span class="form-label">çº¸å¼ å¤§å°</span>
          <select class="form-select"><option>A4</option><option>A5</option><option>è‡ªå®šä¹‰</option></select>
        </div>
        <button class="btn btn-primary" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="alert('æ‰“å°æœºè®¾ç½®å·²ä¿å­˜')">ä¿å­˜</button>
      </div>

      <!-- æŠ¥è­¦è®¾ç½® -->
      <div class="sys-tab-content" id="tab-alarm">
        <div class="form-row" style="margin-bottom:20px;">
          <span class="form-label">å£°éŸ³æŠ¥è­¦</span>
          <div class="toggle-switch">
            <div class="toggle-track on" id="alarmSound" onclick="this.classList.toggle('on')">
              <div class="toggle-thumb"></div>
            </div>
            <span>å¼€å¯</span>
          </div>
        </div>
        <div class="form-row">
          <span class="form-label">æŠ¥è­¦å»¶æ—¶(ms)</span>
          <input type="number" class="form-input" value="500">
        </div>
        <div class="form-row">
          <span class="form-label">æŠ¥è­¦é—´éš”(ms)</span>
          <input type="number" class="form-input" value="2000">
        </div>
        <div style="margin-top:16px; display:flex; gap:12px;">
          <button class="btn btn-warning" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="alert('æµ‹è¯•æŠ¥è­¦å·²è§¦å‘')">æµ‹è¯•æŠ¥è­¦</button>
          <button class="btn btn-primary" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="alert('æŠ¥è­¦è®¾ç½®å·²ä¿å­˜')">ä¿å­˜</button>
        </div>
      </div>

      <!-- æ•°æ®åº“è¿æ¥ -->
      <div class="sys-tab-content" id="tab-db">
        <div style="background:#FEF3C7; border:1px solid #FCD34D; border-radius:8px; padding:10px 14px; margin-bottom:16px; font-size:13px; color:#92400E;">
          âš  1å·æœºæ•°æ®å­˜å…¥2å·æœºæ•°æ®åº“ï¼ˆå±€åŸŸç½‘è®¿é—®ï¼‰ï¼Œè¯·æ­£ç¡®é…ç½®2å·æœºIPå’Œæ•°æ®åº“ä¿¡æ¯
        </div>
        <div class="form-row">
          <span class="form-label">2å·æœºIPåœ°å€</span>
          <input type="text" class="form-input" value="192.168.1.200" placeholder="å¦‚ï¼š192.168.1.200">
        </div>
        <div class="form-row">
          <span class="form-label">æ•°æ®åº“ç«¯å£</span>
          <input type="number" class="form-input" value="3306" placeholder="3306">
        </div>
        <div class="form-row">
          <span class="form-label">æ•°æ®åº“å</span>
          <input type="text" class="form-input" value="production_db" placeholder="æ•°æ®åº“åç§°">
        </div>
        <div class="form-row">
          <span class="form-label">ç”¨æˆ·å</span>
          <input type="text" class="form-input" value="admin" placeholder="æ•°æ®åº“ç”¨æˆ·å">
        </div>
        <div class="form-row">
          <span class="form-label">å¯†ç </span>
          <input type="password" class="form-input" value="123456" placeholder="æ•°æ®åº“å¯†ç ">
        </div>
        <div style="display:flex; gap:12px; align-items:center;">
          <button class="btn btn-secondary" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="testDbConn()">è¿æ¥æµ‹è¯•</button>
          <button class="btn btn-primary" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="alert('æ•°æ®åº“é…ç½®å·²ä¿å­˜')">ä¿å­˜</button>
          <span id="dbTestResult" style="font-size:13px;"></span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" style="height:36px; font-size:13px; width:auto; padding:0 16px;" onclick="closeSys()">å…³é—­</button>
    </div>
  </div>
</div>

<script>
// å®æ—¶æ—¶é’Ÿ
function updateTime() {
  const now = new Date();
  const s = d => String(d).padStart(2,'0');
  document.getElementById('currentTime').textContent =
    `${now.getFullYear()}-${s(now.getMonth()+1)}-${s(now.getDate())} ${s(now.getHours())}:${s(now.getMinutes())}:${s(now.getSeconds())}`;
}
updateTime(); setInterval(updateTime, 1000);

// é‡‡é›†çŠ¶æ€
let isRunning = false;
let totalBottles = 0, totalBoxes = 0;
let simInterval = null;

function toggleCapture() {
  const btn = document.getElementById('startBtn');
  const ind = document.getElementById('runningIndicator');
  if (!isRunning) {
    // å¼€å§‹é‡‡é›†
    isRunning = true;
    btn.textContent = 'åœæ­¢é‡‡é›†';
    btn.classList.add('running');
    ind.style.display = 'inline-flex';
    startSimulation();
  } else {
    // åœæ­¢é‡‡é›†
    isRunning = false;
    btn.textContent = 'å¼€å§‹é‡‡é›†';
    btn.classList.remove('running');
    ind.style.display = 'none';
    if (simInterval) { clearInterval(simInterval); simInterval = null; }
  }
}

function startSimulation() {
  let cycle = 0;
  simInterval = setInterval(() => {
    if (!isRunning) return;
    cycle++;
    const n = document.getElementById('bottlesPerBox').value;
    const batchNum = String(Date.now()).slice(-6);
    const now = new Date();
    const ts = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;

    // ç”Ÿæˆç“¶ç 
    const codes1 = [], codes2 = [];
    const halfN = Math.ceil(n/2);
    for(let i=0; i<halfN; i++) codes1.push(`2024${batchNum}${String(cycle*10+i+1).padStart(4,'0')}`);
    for(let i=halfN; i<n; i++) codes2.push(`2024${batchNum}${String(cycle*10+i+1).padStart(4,'0')}`);

    const hasError = cycle % 7 === 0; // æ¯7æ¬¡æ¨¡æ‹Ÿä¸€æ¬¡é‡ç 

    let bottleHtml = `<div class="log-entry ${hasError ? 'log-error' : 'log-success'}">`;
    bottleHtml += `<span class="log-time">${ts}</span>`;
    bottleHtml += `ç“¶1è¯»ç ï¼š${codes1.map(c=>`<span style="color:#2563EB;">${c}</span>`).join('ã€')}`;
    if(codes2.length > 0) bottleHtml += ` &nbsp;&nbsp; ç“¶2è¯»ç ï¼š${codes2.map(c=>`<span style="color:#2563EB;">${c}</span>`).join('ã€')}`;
    if(hasError) {
      bottleHtml += ` &nbsp;|&nbsp; <span style="background:#FEE2E2;padding:1px 4px;border-radius:3px;">âš  æ£€æµ‹åˆ°é‡ç ï¼Œå·²æ ‡è®°å‰”é™¤</span>`;
      showAlarm('æ£€æµ‹åˆ°é‡ç ï¼š20241201'+batchNum+'ï¼Œå·²æ ‡è®°å‰”é™¤');
    }
    bottleHtml += '</div>';

    prependLog('bottleLogArea', bottleHtml);

    // å…³è”ç›’ç 
    const boxCode = `2024${batchNum}${String(9000+cycle).padStart(4,'0')}`;
    totalBottles += parseInt(n);
    totalBoxes++;
    document.getElementById('totalBottles').textContent = totalBottles;
    document.getElementById('totalBoxes').textContent = totalBoxes;

    const boxHtml = `<div class="log-entry log-success">
      <span class="log-time">${ts}</span>
      ç›’è¯»ç ï¼š${boxCode} &nbsp;|&nbsp; <strong>${totalBoxes}ç›’ç å…³è”æˆåŠŸ</strong>
    </div>`;
    prependLog('boxLogArea', boxHtml);

  }, 2500);
}

function prependLog(areaId, html) {
  const area = document.getElementById(areaId);
  area.insertAdjacentHTML('afterbegin', html);
  // é™åˆ¶1000æ¡
  const entries = area.querySelectorAll('.log-entry');
  if(entries.length > 100) entries[entries.length-1].remove();
}

function clearScreen() {
  if(confirm('ç¡®è®¤æ¸…å±ï¼Ÿå°†æ¸…é™¤æ‰€æœ‰è¯»ç è®°å½•')) {
    document.getElementById('bottleLogArea').innerHTML = '';
    document.getElementById('boxLogArea').innerHTML = '';
  }
}

function showAlarm(msg) {
  document.getElementById('alarmMsg').textContent = msg || 'å…³è”å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥';
  document.getElementById('alarmBar').classList.add('show');
}

function closeAlarm() {
  document.getElementById('alarmBar').classList.remove('show');
}

// ç³»ç»Ÿè®¾ç½® - å¯†ç éªŒè¯
function openSysSettings() {
  document.getElementById('pwdInput').value = '';
  document.getElementById('pwdError').textContent = '';
  document.getElementById('pwdOverlay').classList.add('active');
  setTimeout(() => document.getElementById('pwdInput').focus(), 100);
}

function closePwd() {
  document.getElementById('pwdOverlay').classList.remove('active');
}

function closePwdIfOutside(e) {
  if(e.target === document.getElementById('pwdOverlay')) closePwd();
}

function verifyPwd() {
  const pwd = document.getElementById('pwdInput').value;
  if(pwd === '123456') {
    closePwd();
    document.getElementById('sysOverlay').classList.add('active');
  } else {
    document.getElementById('pwdError').textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
    document.getElementById('pwdInput').value = '';
    document.getElementById('pwdInput').focus();
  }
}

function closeSys() {
  document.getElementById('sysOverlay').classList.remove('active');
}

function closeSysIfOutside(e) {
  if(e.target === document.getElementById('sysOverlay')) closeSys();
}

function switchSysTab(el, tabId) {
  document.querySelectorAll('.sys-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.sys-tab-content').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

function testDbConn() {
  const result = document.getElementById('dbTestResult');
  result.textContent = 'æ­£åœ¨è¿æ¥...';
  result.style.color = '#6B7280';
  setTimeout(() => {
    result.textContent = 'âœ“ è¿æ¥æˆåŠŸ';
    result.style.color = '#16A34A';
  }, 1200);
}

function confirmExit() {
  if(confirm('ç¡®è®¤é€€å‡ºç³»ç»Ÿï¼Ÿ')) window.close();
}

// ESCå…³é—­å¼¹çª—
document.addEventListener('keydown', e => {
  if(e.key === 'Escape') {
    closePwd(); closeSys();
  }
});
</script>
</body>
</html>
